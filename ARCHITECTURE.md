# Application Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Browser                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           React Frontend (Port 5173)                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Pages      â”‚  â”‚  Components  â”‚  â”‚   Context    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ - Dashboard  â”‚  â”‚ - ChildCard  â”‚  â”‚ - Auth       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ - Tasks      â”‚  â”‚ - Modal      â”‚  â”‚              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ - Rewards    â”‚  â”‚ - Layout     â”‚  â”‚              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ - Detail     â”‚  â”‚              â”‚  â”‚              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚         â”‚                                               â”‚ â”‚
â”‚  â”‚         â”‚ API Calls                                     â”‚ â”‚
â”‚  â”‚         â–¼                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚          API Client Layer                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  /api/auth, /api/children, /api/tasks, etc.     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP/JSON + Cookies
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Express Backend (Port 3000)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Middleware                            â”‚ â”‚
â”‚  â”‚  - CORS                                                 â”‚ â”‚
â”‚  â”‚  - Cookie Parser                                        â”‚ â”‚
â”‚  â”‚  - Auth Token Validation                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Routes                              â”‚ â”‚
â”‚  â”‚  /api/auth     â†’ authController                         â”‚ â”‚
â”‚  â”‚  /api/children â†’ childrenController                     â”‚ â”‚
â”‚  â”‚  /api/tasks    â†’ tasksController                        â”‚ â”‚
â”‚  â”‚  /api/rewards  â†’ rewardsController                      â”‚ â”‚
â”‚  â”‚  /api/activity â†’ activityController                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Controllers                            â”‚ â”‚
â”‚  â”‚  - Business Logic                                       â”‚ â”‚
â”‚  â”‚  - Input Validation                                     â”‚ â”‚
â”‚  â”‚  - Response Formatting                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Database Wrapper                           â”‚ â”‚
â”‚  â”‚  - prepare(), run(), get(), all()                       â”‚ â”‚
â”‚  â”‚  - Transaction support                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SQLite Database (sql.js)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  users   â”‚  â”‚ children â”‚  â”‚  tasks   â”‚  â”‚ rewards  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ completions  â”‚  â”‚ redemptions â”‚  â”‚  point_adjust   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Examples

### 1. User Registration

```
User Input â†’ RegisterPage â†’ authAPI.register()
    â†“
POST /api/auth/register â†’ authController.register()
    â†“
- Hash password with bcrypt
- Insert into users table
- Generate JWT token
- Set HTTP-only cookie
    â†“
Return user object â†’ Update AuthContext â†’ Redirect to Dashboard
```

### 2. Complete Task

```
User clicks "Complete" â†’ TasksPage â†’ Modal opens
    â†“
Select child + optional notes â†’ Submit form
    â†“
POST /api/tasks/:id/complete â†’ tasksController.completeTask()
    â†“
Transaction:
  1. Insert into task_completions
  2. Update children.current_points (+points)
  3. Save database
    â†“
Return updated child â†’ Refresh children list â†’ Update UI
```

### 3. Redeem Reward

```
User clicks "Redeem" â†’ RewardsPage â†’ Modal opens
    â†“
Select child â†’ Check available points in UI
    â†“
POST /api/rewards/:id/redeem â†’ rewardsController.redeemReward()
    â†“
Validate:
  - Reward exists
  - Child exists
  - Sufficient points (child.current_points >= reward.point_cost)
    â†“
Transaction:
  1. Insert into redemptions
  2. Update children.current_points (-points)
  3. Save database
    â†“
Return updated child â†’ Refresh children list â†’ Update UI
```

### 4. View Child Statistics

```
User clicks child card â†’ Navigate to /children/:id
    â†“
Parallel requests:
  - GET /api/children/:id        â†’ Get child details
  - GET /api/children/:id/activity â†’ Get activity history
  - GET /api/children/:id/stats   â†’ Get statistics
    â†“
activityController.getChildStats():
  - Query task completions
  - Query redemptions
  - Query point adjustments
  - Calculate totals
  - Generate badge list
  - Return aggregated data
    â†“
Render:
  - Child profile header
  - Statistics cards
  - Achievement badges
  - Points chart (Recharts)
  - Activity feed
```

## Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Initial Page Load                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  AuthContext useEffect      â”‚
              â”‚  GET /api/auth/me           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
                â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ JWT Valid     â”‚        â”‚ No JWT       â”‚
        â”‚ Return user   â”‚        â”‚ Return 401   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                       â”‚
                â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Set user      â”‚        â”‚ Set user=nullâ”‚
        â”‚ state         â”‚        â”‚ state        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                       â”‚
                â”‚                       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  ProtectedRoute       â”‚
                â”‚  checks user state    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
                â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ user exists   â”‚        â”‚ user is null â”‚
        â”‚ Show content  â”‚        â”‚ Redirect to  â”‚
        â”‚               â”‚        â”‚ /login       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Hierarchy

```
App
â”œâ”€â”€ BrowserRouter
â””â”€â”€ AuthProvider
    â””â”€â”€ Layout
        â”œâ”€â”€ Header
        â”‚   â”œâ”€â”€ Logo
        â”‚   â””â”€â”€ UserInfo (with Logout button)
        â”œâ”€â”€ Nav
        â”‚   â””â”€â”€ Navigation Links
        â””â”€â”€ Routes
            â”œâ”€â”€ /login â†’ LoginPage
            â”œâ”€â”€ /register â†’ RegisterPage
            â”œâ”€â”€ / â†’ ProtectedRoute â†’ Dashboard
            â”‚   â””â”€â”€ ChildCard (multiple)
            â”œâ”€â”€ /tasks â†’ ProtectedRoute â†’ TasksPage
            â”‚   â”œâ”€â”€ TaskCard (multiple)
            â”‚   â””â”€â”€ Modal (create/complete)
            â”œâ”€â”€ /rewards â†’ ProtectedRoute â†’ RewardsPage
            â”‚   â”œâ”€â”€ RewardCard (multiple)
            â”‚   â””â”€â”€ Modal (create/redeem)
            â””â”€â”€ /children/:id â†’ ProtectedRoute â†’ ChildDetailPage
                â”œâ”€â”€ Child Header
                â”œâ”€â”€ Stats Grid
                â”œâ”€â”€ Badges Section
                â”œâ”€â”€ Points Chart
                â””â”€â”€ Activity Feed
```

## Database Relationships

```
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    users    â”‚
                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
                            â”‚ id          â”‚
                            â”‚ email       â”‚
                            â”‚ password    â”‚
                            â”‚ name        â”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚              â”‚              â”‚
                    â–¼              â–¼              â–¼              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   children   â”‚ â”‚  tasks   â”‚ â”‚ rewards  â”‚ â”‚ (user owns)  â”‚
            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚              â”‚
            â”‚ id           â”‚ â”‚ id       â”‚ â”‚ id       â”‚ â”‚              â”‚
            â”‚ user_id (FK) â”‚ â”‚ user_id  â”‚ â”‚ user_id  â”‚ â”‚              â”‚
            â”‚ name         â”‚ â”‚ name     â”‚ â”‚ name     â”‚ â”‚              â”‚
            â”‚ current_pts  â”‚ â”‚ points   â”‚ â”‚ cost     â”‚ â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
                   â”‚              â”‚            â”‚        â”‚              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
         â”‚         â”‚              â”‚            â”‚                       â”‚
         â–¼         â”‚              â”‚            â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚            â”‚                       â”‚
â”‚ point_adjust   â”‚ â”‚              â”‚            â”‚                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚              â”‚            â”‚                       â”‚
â”‚ child_id (FK)  â”‚â—€â”˜              â”‚            â”‚                       â”‚
â”‚ amount         â”‚                â”‚            â”‚                       â”‚
â”‚ reason         â”‚                â”‚            â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚            â”‚                       â”‚
                                  â”‚            â”‚                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”        â”‚                       â”‚
         â”‚                            â”‚        â”‚                       â”‚
         â–¼                            â–¼        â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ task_completions   â”‚       â”‚   redemptions      â”‚                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                   â”‚
â”‚ task_id (FK)       â”‚       â”‚ reward_id (FK)     â”‚                   â”‚
â”‚ child_id (FK)      â”‚       â”‚ child_id (FK)      â”‚                   â”‚
â”‚ points_earned      â”‚       â”‚ points_spent       â”‚                   â”‚
â”‚ completed_at       â”‚       â”‚ redeemed_at        â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Layers

```
1. Frontend
   â”œâ”€â”€ HTTP-only cookies (no JS access to JWT)
   â”œâ”€â”€ CSRF protection via SameSite cookie attribute
   â””â”€â”€ Client-side route protection

2. Network
   â”œâ”€â”€ CORS configuration (specific origin)
   â””â”€â”€ Secure cookie flag (production)

3. Backend
   â”œâ”€â”€ JWT verification middleware
   â”œâ”€â”€ Token expiration (7 days)
   â””â”€â”€ User ID embedded in token

4. Database
   â”œâ”€â”€ Parameterized queries (SQL injection prevention)
   â”œâ”€â”€ Foreign key constraints
   â””â”€â”€ User isolation (queries filtered by user_id)

5. Authentication
   â”œâ”€â”€ bcrypt password hashing (10 rounds)
   â””â”€â”€ Password complexity (frontend validation)
```

## API Request/Response Examples

### POST /api/auth/register
**Request:**
```json
{
  "email": "parent@example.com",
  "password": "securepass123",
  "name": "John Doe"
}
```

**Response:**
```json
{
  "user": {
    "id": 1,
    "email": "parent@example.com",
    "name": "John Doe"
  }
}
```
**Cookie Set:** `token=eyJhbGc...` (HTTP-only)

### POST /api/tasks/5/complete
**Request:**
```json
{
  "child_id": 2,
  "notes": "Great job!"
}
```

**Response:**
```json
{
  "message": "Task completed successfully",
  "child": {
    "id": 2,
    "name": "Alice",
    "current_points": 45
  },
  "points_earned": 15
}
```

### GET /api/children/2/stats
**Response:**
```json
{
  "stats": {
    "totalTasksCompleted": 12,
    "totalPointsEarned": 180,
    "totalRewardsRedeemed": 3,
    "totalPointsSpent": 135,
    "currentPoints": 45
  },
  "pointsOverTime": [
    { "date": "2024-01-20", "points": 25 },
    { "date": "2024-01-21", "points": 30 }
  ],
  "tasksByCategory": [
    { "category": "Chores", "count": 7 },
    { "category": "Homework", "count": 5 }
  ],
  "badges": [
    { "name": "First 100 Points", "icon": "ğŸŒŸ" },
    { "name": "10 Tasks Complete", "icon": "âœ…" }
  ]
}
```

## Performance Considerations

1. **Database Operations**
   - Transactions for atomic updates
   - Prepared statements (cached by sql.js)
   - Indexed foreign keys

2. **Frontend**
   - Code splitting (React.lazy - future enhancement)
   - CSS Modules (scoped, optimized)
   - Vite HMR for development

3. **API**
   - Parallel requests where possible
   - Minimal data transfer (only needed fields)
   - Efficient queries with JOINs

4. **State Management**
   - React Context for auth (global)
   - Local state for page-specific data
   - Automatic re-fetching on actions
